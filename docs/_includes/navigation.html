{% capture html %}
<ul class="nav">
    {% assign page_slug   = page.url | split: "/" | last %}
    {% assign page_folder = page.url | remove: page_slug %}

    {% assign entries = include.entries %}

    {% for entry in entries %}

        {% assign entry_slug = entry.url | split: "/" | last %}
        {% assign entry_folder = entry.url | remove: entry_slug %}

        {% if entry_folder == include.context %}

            {% assign entry_subfolder = entry.url | remove: ".html" | append: "/" %}

            {% if page.url contains entry.url or page_folder contains entry_subfolder %}
              {% assign entry_active = true %}
            {% else %}
              {% assign entry_active = false %}
            {% endif %}

            {% if entry_active == true %}

                {% assign subentries = "" | split : "|" %}
                {% for subentry in entries %}
                  {% assign subentry_slug = subentry.url | split: "/" | last %}
                  {% assign subentry_folder = subentry.url | remove: subentry_slug %}

                  {% if subentry_folder contains entry_subfolder %}
                    {% assign subentries = subentries | push: subentry %}
                  {% endif %}

                {% endfor %}

            {% endif %}

            <li class="{% if entry_active == true %}active{% endif %}">
                <a href="{{ site.baseurl }}{{ entry.url }}">{{ entry.title }}</a>

                {% if entry_active == true and subentries.size > 0 %}
                    {% include navigation.html context=entry_subfolder entries=subentries %}
                {% endif %}
            </li>

        {% endif %}

    {% endfor %}

</ul>
{% endcapture %}{{ html | strip_newlines | replace:'    ','' | replace:'    ','' | replace:'  ',' ' }}
